#!/usr/bin/bash
#!/usr/bin/bash
#Copyright Andrea Di Iorio
#This file is part of scripts
#scripts is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.
#
#scripts is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.
#
#You should have received a copy of the GNU General Public License
#along with scripts.  If not, see <http://www.gnu.org/licenses/>.
#!/usr/bin/env bash
spinner_base() {
    local i sp n
    sp='/-\|'
    n=${#sp}
    printf ' '
    while sleep 0.1; do
        printf "%s\b" "${sp:i++%n:1}"
    done
}
spinner_echo() {
    local i sp n
    sp=("⢀⠀"  "⡀⠀"  "⠄⠀"  "⢂⠀"  "⡂⠀"  "⠅⠀"  "⢃⠀"  "⡃⠀"  "⠍⠀"  "⢋⠀"  "⡋⠀"  "⠍⠁"  "⢋⠁"  "⡋⠁"  "⠍⠉"  "⠋⠉"  "⠋⠉"  "⠉⠙"  "⠉⠙"  "⠉⠩"  "⠈⢙"  "⠈⡙"  "⢈⠩"  "⡀⢙"  "⠄⡙"  "⢂⠩"  "⡂⢘"  "⠅⡘"  "⢃⠨"  "⡃⢐"  "⠍⡐"  "⢋⠠"  "⡋⢀"  "⠍⡁"  "⢋⠁"  "⡋⠁"  "⠍⠉"  "⠋⠉"  "⠋⠉"  "⠉⠙"  "⠉⠙"  "⠉⠩"  "⠈⢙"  "⠈⡙"  "⠈⠩"  "⠀⢙"  "⠀⡙"  "⠀⠩"  "⠀⢘"  "⠀⡘"  "⠀⠨"  "⠀⢐"  "⠀⡐"  "⠀⠠"  "⠀⢀"  "⠀⡀")
    n=${#sp[@]}
    i=0
    SPINNERS_IN_LINE=33
    echo $n $i ${sp[@]}
    while sleep 0.01; do
    	i=$(((i+1)%n))
    	echo -en "\r"
	for j in $(seq 1 $SPINNERS_IN_LINE);do
		echo -en "${sp[i]} "
	done
    done
}
spinnerHuge=( "[                                                                                                             ]" "[                                                                                                            °]" "[                                                                                                           °°]" "[                                                                                                          °°°]" "[                                                                                                         °°°°]" "[                                                                                                        °°°°°]" "[                                                                                                       °°°°°°]" "[                                                                                                      °°°°°° ]" "[                                                                                                     °°°°°°  ]" "[                                                                                                    °°°°°°   ]" "[                                                                                                   °°°°°°    ]" "[                                                                                                  °°°°°°     ]" "[                                                                                                 °°°°°°      ]" "[                                                                                                °°°°°°       ]" "[                                                                                               °°°°°°        ]" "[                                                                                              °°°°°°         ]" "[                                                                                             °°°°°°          ]" "[                                                                                            °°°°°°           ]" "[                                                                                           °°°°°°            ]" "[                                                                                          °°°°°°             ]" "[                                                                                         °°°°°°              ]" "[                                                                                        °°°°°°               ]" "[                                                                                       °°°°°°                ]" "[                                                                                      °°°°°°                 ]" "[                                                                                     °°°°°°                  ]" "[                                                                                    °°°°°°                   ]" "[                                                                                   °°°°°°                    ]" "[                                                                                  °°°°°°                     ]" "[                                                                                 °°°°°°                      ]" "[                                                                                °°°°°°                       ]" "[                                                                               °°°°°°                        ]" "[                                                                              °°°°°°                         ]" "[                                                                             °°°°°°                          ]" "[                                                                            °°°°°°                           ]" "[                                                                           °°°°°°                            ]" "[                                                                          °°°°°°                             ]" "[                                                                         °°°°°°                              ]" "[                                                                        °°°°°°                               ]" "[                                                                       °°°°°°                                ]" "[                                                                      °°°°°°                                 ]" "[                                                                     °°°°°°                                  ]" "[                                                                    °°°°°°                                   ]" "[                                                                   °°°°°°                                    ]" "[                                                                  °°°°°°                                     ]" "[                                                                 °°°°°°                                      ]" "[                                                                °°°°°°                                       ]" "[                                                               °°°°°°                                        ]" "[                                                              °°°°°°                                         ]" "[                                                             °°°°°°                                          ]" "[                                                            °°°°°°                                           ]" "[                                                           °°°°°°                                            ]" "[                                                          °°°°°°                                             ]" "[                                                         °°°°°°                                              ]" "[                                                        °°°°°°                                               ]" "[                                                       °°°°°°                                                ]" "[                                                      °°°°°°                                                 ]" "[                                                     °°°°°°                                                  ]" "[                                                    °°°°°°                                                   ]" "[                                                   °°°°°°                                                    ]" "[                                                  °°°°°°                                                     ]" "[                                                 °°°°°°                                                      ]" "[                                                °°°°°°                                                       ]" "[                                               °°°°°°                                                        ]" "[                                              °°°°°°                                                         ]" "[                                             °°°°°°                                                          ]" "[                                            °°°°°°                                                           ]" "[                                           °°°°°°                                                            ]" "[                                          °°°°°°                                                             ]" "[                                         °°°°°°                                                              ]" "[                                        °°°°°°                                                               ]" "[                                       °°°°°°                                                                ]" "[                                      °°°°°°                                                                 ]" "[                                     °°°°°°                                                                  ]" "[                                    °°°°°°                                                                   ]" "[                                   °°°°°°                                                                    ]" "[                                  °°°°°°                                                                     ]" "[                                 °°°°°°                                                                      ]" "[                                °°°°°°                                                                       ]" "[                               °°°°°°                                                                        ]" "[                              °°°°°°                                                                         ]" "[                             °°°°°°                                                                          ]" "[                            °°°°°°                                                                           ]" "[                           °°°°°°                                                                            ]" "[                          °°°°°°                                                                             ]" "[                         °°°°°°                                                                              ]" "[                        °°°°°°                                                                               ]" "[                       °°°°°°                                                                                ]" "[                      °°°°°°                                                                                 ]" "[                     °°°°°°                                                                                  ]" "[                    °°°°°°                                                                                   ]" "[                   °°°°°°                                                                                    ]" "[                  °°°°°°                                                                                     ]" "[                 °°°°°°                                                                                      ]" "[                °°°°°°                                                                                       ]" "[               °°°°°°                                                                                        ]" "[              °°°°°°                                                                                         ]" "[             °°°°°°                                                                                          ]" "[            °°°°°°                                                                                           ]" "[           °°°°°°                                                                                            ]" "[          °°°°°°                                                                                             ]" "[         °°°°°°                                                                                              ]" "[        °°°°°°                                                                                               ]" "[       °°°°°°                                                                                                ]" "[      °°°°°°                                                                                                 ]" "[     °°°°°°                                                                                                  ]" "[    °°°°°°                                                                                                   ]" "[   °°°°°°                                                                                                    ]" "[  °°°°°°                                                                                                     ]" "[ °°°°°°                                                                                                      ]" "[°°°°°°                                                                                                       ]" "[°°°°°°                                                                                                       ]" "[°°°°°                                                                                                        ]" "[°°°°                                                                                                         ]" "[°°°                                                                                                          ]" "[°°                                                                                                           ]" "[°                                                                                                            ]" "[                                                                                                             ]" "[                                                                                                             ]" "[°                                                                                                            ]" "[°°                                                                                                           ]" "[°°°                                                                                                          ]" "[°°°°                                                                                                         ]" "[°°°°°                                                                                                        ]" "[°°°°°°                                                                                                       ]" "[°°°°°°                                                                                                       ]" "[ °°°°°°                                                                                                      ]" "[  °°°°°°                                                                                                     ]" "[   °°°°°°                                                                                                    ]" "[    °°°°°°                                                                                                   ]" "[     °°°°°°                                                                                                  ]" "[      °°°°°°                                                                                                 ]" "[       °°°°°°                                                                                                ]" "[        °°°°°°                                                                                               ]" "[         °°°°°°                                                                                              ]" "[          °°°°°°                                                                                             ]" "[           °°°°°°                                                                                            ]" "[            °°°°°°                                                                                           ]" "[             °°°°°°                                                                                          ]" "[              °°°°°°                                                                                         ]" "[               °°°°°°                                                                                        ]" "[                °°°°°°                                                                                       ]" "[                 °°°°°°                                                                                      ]" "[                  °°°°°°                                                                                     ]" "[                   °°°°°°                                                                                    ]" "[                    °°°°°°                                                                                   ]" "[                     °°°°°°                                                                                  ]" "[                      °°°°°°                                                                                 ]" "[                       °°°°°°                                                                                ]" "[                        °°°°°°                                                                               ]" "[                         °°°°°°                                                                              ]" "[                          °°°°°°                                                                             ]" "[                           °°°°°°                                                                            ]" "[                            °°°°°°                                                                           ]" "[                             °°°°°°                                                                          ]" "[                              °°°°°°                                                                         ]" "[                               °°°°°°                                                                        ]" "[                                °°°°°°                                                                       ]" "[                                 °°°°°°                                                                      ]" "[                                  °°°°°°                                                                     ]" "[                                   °°°°°°                                                                    ]" "[                                    °°°°°°                                                                   ]" "[                                     °°°°°°                                                                  ]" "[                                      °°°°°°                                                                 ]" "[                                       °°°°°°                                                                ]" "[                                        °°°°°°                                                               ]" "[                                         °°°°°°                                                              ]" "[                                          °°°°°°                                                             ]" "[                                           °°°°°°                                                            ]" "[                                            °°°°°°                                                           ]" "[                                             °°°°°°                                                          ]" "[                                              °°°°°°                                                         ]" "[                                               °°°°°°                                                        ]" "[                                                °°°°°°                                                       ]" "[                                                 °°°°°°                                                      ]" "[                                                  °°°°°°                                                     ]" "[                                                   °°°°°°                                                    ]" "[                                                    °°°°°°                                                   ]" "[                                                     °°°°°°                                                  ]" "[                                                      °°°°°°                                                 ]" "[                                                       °°°°°°                                                ]" "[                                                        °°°°°°                                               ]" "[                                                         °°°°°°                                              ]" "[                                                          °°°°°°                                             ]" "[                                                           °°°°°°                                            ]" "[                                                            °°°°°°                                           ]" "[                                                             °°°°°°                                          ]" "[                                                              °°°°°°                                         ]" "[                                                               °°°°°°                                        ]" "[                                                                °°°°°°                                       ]" "[                                                                 °°°°°°                                      ]" "[                                                                  °°°°°°                                     ]" "[                                                                   °°°°°°                                    ]" "[                                                                    °°°°°°                                   ]" "[                                                                     °°°°°°                                  ]" "[                                                                      °°°°°°                                 ]" "[                                                                       °°°°°°                                ]" "[                                                                        °°°°°°                               ]" "[                                                                         °°°°°°                              ]" "[                                                                          °°°°°°                             ]" "[                                                                           °°°°°°                            ]" "[                                                                            °°°°°°                           ]" "[                                                                             °°°°°°                          ]" "[                                                                              °°°°°°                         ]" "[                                                                               °°°°°°                        ]" "[                                                                                °°°°°°                       ]" "[                                                                                 °°°°°°                      ]" "[                                                                                  °°°°°°                     ]" "[                                                                                   °°°°°°                    ]" "[                                                                                    °°°°°°                   ]" "[                                                                                     °°°°°°                  ]" "[                                                                                      °°°°°°                 ]" "[                                                                                       °°°°°°                ]" "[                                                                                        °°°°°°               ]" "[                                                                                         °°°°°°              ]" "[                                                                                          °°°°°°             ]" "[                                                                                           °°°°°°            ]" "[                                                                                            °°°°°°           ]" "[                                                                                             °°°°°°          ]" "[                                                                                              °°°°°°         ]" "[                                                                                               °°°°°°        ]" "[                                                                                                °°°°°°       ]" "[                                                                                                 °°°°°°      ]" "[                                                                                                  °°°°°°     ]" "[                                                                                                   °°°°°°    ]" "[                                                                                                    °°°°°°   ]" "[                                                                                                     °°°°°°  ]" "[                                                                                                      °°°°°° ]" "[                                                                                                       °°°°°°]" "[                                                                                                        °°°°°]" "[                                                                                                         °°°°]" "[                                                                                                          °°°]" "[                                                                                                           °°]" "[                                                                                                            °]" "[                                                                                                             ]")

sp00=("[              ]" "[             =]" "[            ==]" "[           ===]" "[          ====]" "[         ==== ]" "[        ====  ]" "[      =====   ]" "[     =====    ]" "[    =====     ]" "[   =====      ]" "[  ====        ]" "[ ====         ]" "[====          ]" "[===           ]" "[==            ]" "[=             ]" "[              ]" "[=             ]" "[==            ]" "[===           ]" "[====          ]" "[ ====         ]" "[  ====        ]" "[   ====       ]" "[    ====      ]" "[     ====     ]" "[      ====    ]" "[       ====   ]" "[        ====  ]" "[         ==== ]" "[          ====]" "[           ===]" "[            ==]" "[             =]" )
sp0=("[              ]" "[             =]" "[            ==]" "[           ===]" "[         === ]" "[        ===  ]" "[      ===   ]" "[     ===    ]" "[    ===     ]" "[   ===      ]" "[  ===        ]" "[ ===         ]" "[===          ]" "[===           ]" "[==            ]" "[=             ]" "[              ]" "[=             ]" "[==            ]" "[===           ]"  "[ ===         ]" "[  ===        ]" "[   ===       ]" "[    ===      ]" "[     ===     ]" "[      ===    ]" "[       ===   ]" "[        ===  ]" "[         === ]" "[          ===]" "[            ==]" "[             =]" )
sp1=("[    ]" "[   =]" "[  ==]" "[ ===]" "[===]" "[=== ]" "[==  ]" "[=   ]")
sp2=("( ●    )" "(  ●   )" "(   ●  )" "(    ● )" "(     ●)" "(    ● )" "(   ●  )" "(  ●   )" "( ●    )" "(●     )")
sp3=("⢀⠀"  "⡀⠀"  "⠄⠀"  "⢂⠀"  "⡂⠀"  "⠅⠀"  "⢃⠀"  "⡃⠀"  "⠍⠀"  "⢋⠀"  "⡋⠀"  "⠍⠁"  "⢋⠁"  "⡋⠁"  "⠍⠉"  "⠋⠉"  "⠋⠉"  "⠉⠙"  "⠉⠙"  "⠉⠩"  "⠈⢙"  "⠈⡙"  "⢈⠩"  "⡀⢙"  "⠄⡙"  "⢂⠩"  "⡂⢘"  "⠅⡘"  "⢃⠨"  "⡃⢐"  "⠍⡐"  "⢋⠠"  "⡋⢀"  "⠍⡁"  "⢋⠁"  "⡋⠁"  "⠍⠉"  "⠋⠉"  "⠋⠉"  "⠉⠙"  "⠉⠙"  "⠉⠩"  "⠈⢙"  "⠈⡙"  "⠈⠩"  "⠀⢙"  "⠀⡙"  "⠀⠩"  "⠀⢘"  "⠀⡘"  "⠀⠨"  "⠀⢐"  "⠀⡐"  "⠀⠠"  "⠀⢀"  "⠀⡀")
spinner_arg() {
    #run the spinner with the array taken from arg 1 and refresh time from arg 2
    local i n 
    declare -a sp=("${!1}")
    n=${#sp[@]}
    sleep_time=$2
    i=0
    SPINNERS_IN_LINE=1
    #echo $n $i ${sp[@]}
    while sleep $2; do
    	i=$(((i+1)%n))
	for j in $(seq 1 $SPINNERS_IN_LINE);do
		printf "\r"
		printf "%s" ""${sp[i]}""
	done
    done
}
spinner() {
    #base printf spinner
    local i n sp
    sp=("${spinnerHuge[@]}")
    n=${#sp[@]}
    i=0
    SPINNERS_IN_LINE=1
    #echo $n $i ${sp[@]}
    while sleep 0.1; do
    	i=$(((i+1)%n))
	for j in $(seq 1 $SPINNERS_IN_LINE);do
		printf "%s" "${sp[i]} "
	done
	printf "\r"
    done
}
spinner_nice_combo() {
    #combination of 2 spinner aggregated in the way 1 2 1
    local i n sp ssp
    sp=("${sp00[@]}")
    ssp=("${sp3[@]}")
    n1=${#sp[@]}
    n2=${#ssp[@]}
    i=0
    SPIN_TIME=0.08
    #echo $n $i ${sp[@]}
    while sleep $SPIN_TIME; do
    	i=$(((i+1)%n1))
    	i1=$(((i+1)%n2))
	printf "\t\t%s" "${ssp[i1]} ${ssp[i1]} ${ssp[i1]}"
	printf "\t%s\t" "${sp[i]}"
	printf "%s" "${ssp[i1]} ${ssp[i1]} ${ssp[i1]}"
	printf "\r"
    done
}
proceduralSpinner() {
	#create a line spinner with configurable number of char, moving char, num of movin char via a python script, then pass array to spinner_arg
	python3 spinner_line_gen.py $1 $2 $3 > a
	IFS=$'\n'			#tmp set bash word splitter to newline
	readarray array < a
	#IFS=$' '			#tmp set bash word splitter to newline
	spinner_arg array[@] $4
}
pythonJsonDecodeSpinnerjson() {
#example usage of simple python script embedded into bash
JSON_FILEPATH="spinners.json"
python_scpt_emdd="
import json,sys
a=open(\"$JSON_FILEPATH\")
j=json.load(a)
ks=list(j.keys())
for k in ks:
 print(j[k][\"frames\"])
"
python3 -c "$python_scpt_emdd"
}

_example_spinners_call(){
spinner &
sleep 4  # sleeping for 10 seconds is important work
kill "$!" # kill the spinner
printf '\n'
}

